<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:Solvix.Client.MVVM.ViewModels"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             x:Class="Solvix.Client.MVVM.Views.LoginPage"
             x:DataType="viewmodels:LoginViewModel"
             Shell.NavBarIsVisible="False"
             Shell.FlyoutBehavior="Disabled"
             BackgroundColor="{DynamicResource PageBackgroundColor}">

    <Shell.BackButtonBehavior>
        <BackButtonBehavior IsVisible="False" IsEnabled="False" />
    </Shell.BackButtonBehavior>

    <Grid RowDefinitions="Auto,*,Auto">
        <!-- Header -->
        <VerticalStackLayout Grid.Row="0" Margin="0,60,0,0" Spacing="10">
            <Image Source="logo.png" HeightRequest="120" WidthRequest="120" HorizontalOptions="Center">
                <Image.Shadow>
                    <Shadow Brush="{DynamicResource PrimaryColor}"
                            Offset="0,0"
                            Opacity="0.3"
                            Radius="15" />
                </Image.Shadow>
            </Image>

            <Label Text="Solvix Chat" FontSize="32" FontAttributes="Bold" HorizontalOptions="Center" 
                   TextColor="{DynamicResource PrimaryTextColor}" Margin="0,10,0,0">
                <Label.Shadow>
                    <Shadow Brush="{DynamicResource PrimaryColor}"
                            Offset="0,0"
                            Opacity="0.2"
                            Radius="2" />
                </Label.Shadow>
            </Label>

            <Label Text="Connect with friends and colleagues" FontSize="16" HorizontalOptions="Center" 
                   TextColor="{DynamicResource SecondaryTextColor}" Margin="0,0,0,20" />
        </VerticalStackLayout>

        <!-- Content -->
        <ScrollView Grid.Row="1" Padding="20,0">
            <VerticalStackLayout Spacing="20" VerticalOptions="Center">
                <!-- Phone Number -->
                <Border BackgroundColor="{DynamicResource CardBackgroundColor}" 
                        Padding="20,15" 
                        StrokeThickness="0"
                        StrokeShape="RoundRectangle 16,16,16,16">
                    <Border.Shadow>
                        <Shadow Brush="{DynamicResource ShadowColor}"
                                Offset="0,4"
                                Opacity="0.1"
                                Radius="8" />
                    </Border.Shadow>
                    <VerticalStackLayout Spacing="8">
                        <Label Text="Phone Number" TextColor="{DynamicResource PrimaryTextColor}" FontSize="14" FontAttributes="Bold" />
                        <Grid ColumnDefinitions="*,Auto">
                            <Entry Grid.Column="0"
                                   Text="{Binding PhoneNumber}"
                                   Placeholder="09XXXXXXXXX"
                                   PlaceholderColor="{DynamicResource TertiaryTextColor}"
                                   TextColor="{DynamicResource PrimaryTextColor}"
                                   BackgroundColor="Transparent"
                                   Keyboard="Telephone"
                                   MaxLength="11"
                                   IsEnabled="{Binding IsLoginEnabled}" />
                            <ActivityIndicator Grid.Column="1" 
                                               IsRunning="{Binding IsPhoneChecking}" 
                                               IsVisible="{Binding IsPhoneChecking}" 
                                               Color="{DynamicResource PrimaryColor}" />
                        </Grid>
                    </VerticalStackLayout>
                </Border>

                <!-- Password -->
                <Border BackgroundColor="{DynamicResource CardBackgroundColor}" 
                        Padding="20,15" 
                        StrokeThickness="0"
                        StrokeShape="RoundRectangle 16,16,16,16"
                        IsVisible="{Binding ShowPasswordField}">
                    <Border.Shadow>
                        <Shadow Brush="{DynamicResource ShadowColor}"
                                Offset="0,4"
                                Opacity="0.1"
                                Radius="8" />
                    </Border.Shadow>
                    <VerticalStackLayout Spacing="8">
                        <Label Text="Password" TextColor="{DynamicResource PrimaryTextColor}" FontSize="14" FontAttributes="Bold" />
                        <Grid ColumnDefinitions="*,Auto">
                            <Entry Grid.Column="0"
                                   Text="{Binding Password}"
                                   Placeholder="Enter your password"
                                   PlaceholderColor="{DynamicResource TertiaryTextColor}"
                                   TextColor="{DynamicResource PrimaryTextColor}"
                                   BackgroundColor="Transparent"
                                   IsPassword="{Binding IsPasswordVisible, Converter={StaticResource InverseBoolConverter}}" />
                            <Button Grid.Column="1"
                                    Text="👁️"
                                    BackgroundColor="Transparent"
                                    TextColor="{DynamicResource PrimaryTextColor}"
                                    Command="{Binding TogglePasswordVisibilityCommand}" />
                        </Grid>
                    </VerticalStackLayout>
                </Border>

                <!-- Registration Fields -->
                <VerticalStackLayout IsVisible="{Binding ShowRegistrationFields}" Spacing="20">
                    <!-- First Name -->
                    <Border BackgroundColor="{DynamicResource CardBackgroundColor}" 
                            Padding="20,15" 
                            StrokeThickness="0"
                            StrokeShape="RoundRectangle 16,16,16,16">
                        <Border.Shadow>
                            <Shadow Brush="{DynamicResource ShadowColor}"
                                    Offset="0,4"
                                    Opacity="0.1"
                                    Radius="8" />
                        </Border.Shadow>
                        <VerticalStackLayout Spacing="8">
                            <Label Text="First Name" TextColor="{DynamicResource PrimaryTextColor}" FontSize="14" FontAttributes="Bold" />
                            <Entry Text="{Binding FirstName}"
                                   Placeholder="Enter your first name"
                                   PlaceholderColor="{DynamicResource TertiaryTextColor}"
                                   TextColor="{DynamicResource PrimaryTextColor}"
                                   BackgroundColor="Transparent" />
                        </VerticalStackLayout>
                    </Border>

                    <!-- Last Name -->
                    <Border BackgroundColor="{DynamicResource CardBackgroundColor}" 
                            Padding="20,15" 
                            StrokeThickness="0"
                            StrokeShape="RoundRectangle 16,16,16,16">
                        <Border.Shadow>
                            <Shadow Brush="{DynamicResource ShadowColor}"
                                    Offset="0,4"
                                    Opacity="0.1"
                                    Radius="8" />
                        </Border.Shadow>
                        <VerticalStackLayout Spacing="8">
                            <Label Text="Last Name" TextColor="{DynamicResource PrimaryTextColor}" FontSize="14" FontAttributes="Bold" />
                            <Entry Text="{Binding LastName}"
                                   Placeholder="Enter your last name"
                                   PlaceholderColor="{DynamicResource TertiaryTextColor}"
                                   TextColor="{DynamicResource PrimaryTextColor}"
                                   BackgroundColor="Transparent" />
                        </VerticalStackLayout>
                    </Border>
                </VerticalStackLayout>

                <!-- Submit Button -->
                <Border BackgroundColor="{DynamicResource PrimaryColor}"
                        StrokeThickness="0"
                        StrokeShape="RoundRectangle 30,30,30,30"
                        HeightRequest="55"
                        Margin="20,30">
                    <Border.Shadow>
                        <Shadow Brush="{DynamicResource PrimaryColor}"
                                Offset="0,6"
                                Opacity="0.3"
                                Radius="15" />
                    </Border.Shadow>
                    <Button Text="{Binding SubmitButtonText}"
                            Command="{Binding SubmitCommand}"
                            IsEnabled="{Binding IsSubmitEnabled}"
                            BackgroundColor="Transparent"
                            TextColor="White"
                            FontAttributes="Bold"
                            FontSize="16"
                            VerticalOptions="Fill"
                            HorizontalOptions="Fill" />
                </Border>

                <!-- Forgot Password -->
                <Button Text="Forgot Password?"
                        Command="{Binding ForgotPasswordCommand}"
                        IsVisible="{Binding ShowPasswordField, Converter={StaticResource BoolToVisibilityConverter}}"
                        BackgroundColor="Transparent"
                        TextColor="{DynamicResource PrimaryColor}"
                        FontAttributes="Bold"
                        CornerRadius="0"
                        Margin="0,0,0,0" />

                <!-- Loading Indicator -->
                <Border Grid.Row="1"
        IsVisible="{Binding IsLoading}"
        HorizontalOptions="Center"
        VerticalOptions="Center"
        StrokeThickness="0"
        StrokeShape="RoundRectangle 12,12,12,12"
        BackgroundColor="{DynamicResource CardBackgroundColor}"
        Padding="20">
                    <Border.Shadow>
                        <Shadow Brush="{DynamicResource ShadowColor}"
                Offset="0,3"
                Opacity="0.2"
                Radius="10" />
                    </Border.Shadow>
                    <VerticalStackLayout Spacing="10">
                        <ActivityIndicator IsRunning="{Binding IsLoading}" 
                           Color="{DynamicResource PrimaryColor}" 
                           HeightRequest="40" 
                           WidthRequest="40" />
                        <Label Text="Loading chat..." 
               TextColor="{DynamicResource PrimaryTextColor}" 
               FontSize="14" 
               HorizontalOptions="Center" />
                    </VerticalStackLayout>
                </Border>
            </VerticalStackLayout>
        </ScrollView>

        <!-- Footer -->
        <VerticalStackLayout Grid.Row="2" Padding="20" Spacing="10" HorizontalOptions="Center">
            <Label Text="© 2025 Solvix Chat" HorizontalOptions="Center" TextColor="{DynamicResource TertiaryTextColor}" FontSize="12" />
            <Label Text="Version 1.0.0" HorizontalOptions="Center" TextColor="{DynamicResource TertiaryTextColor}" FontSize="12" />
        </VerticalStackLayout>
    </Grid>
</ContentPage>