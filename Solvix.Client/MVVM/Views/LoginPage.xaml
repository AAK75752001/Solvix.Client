<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:Solvix.Client.MVVM.ViewModels"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             xmlns:converters="clr-namespace:Solvix.Client.Core.Converters"
             xmlns:controls="clr-namespace:Solvix.Client.MVVM.Controls"
             x:Class="Solvix.Client.MVVM.Views.LoginPage"
             x:DataType="vm:LoginViewModel"
             Shell.NavBarIsVisible="False"
             BackgroundColor="{DynamicResource PageBackgroundColor}">

    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:GreaterThanZeroConverter x:Key="GreaterThanZeroConverter"/>
            <toolkit:InvertedBoolConverter x:Key="InverseBoolConverter" />
            <toolkit:IsStringNotNullOrWhiteSpaceConverter x:Key="IsStringNotNullOrWhiteSpaceConverter"/>

            <Style x:Key="NeonInputFrameStyle" TargetType="Frame">
                <Setter Property="Padding" Value="0"/>
                <Setter Property="Margin" Value="0,5"/>
                <Setter Property="CornerRadius" Value="12"/>
                <Setter Property="BorderColor" Value="Transparent"/>
                <Setter Property="BackgroundColor" Value="{DynamicResource CardBackgroundColor}"/>
                <Setter Property="HasShadow" Value="False"/>
            </Style>

            <Style x:Key="NeonBorderStyle" TargetType="Border">
                <Setter Property="Padding" Value="2"/>
                <Setter Property="StrokeThickness" Value="2"/>
                <Setter Property="BackgroundColor" Value="Transparent"/>
                <Setter Property="StrokeShape">
                    <RoundRectangle CornerRadius="12"/>
                </Setter>
            </Style>
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid>
        <!-- Animated Background -->
        <Grid x:Name="BackgroundGradient" Opacity="0.1">
            <Grid.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                    <GradientStop Color="{DynamicResource GradientStart}" Offset="0.0"/>
                    <GradientStop Color="{DynamicResource GradientMiddle}" Offset="0.5"/>
                    <GradientStop Color="{DynamicResource GradientEnd}" Offset="1.0"/>
                </LinearGradientBrush>
            </Grid.Background>
        </Grid>

        <ScrollView>
            <VerticalStackLayout Padding="30,20" Spacing="15" VerticalOptions="Center">

                <!-- Logo with Glow -->
                <Border HeightRequest="100" 
                        WidthRequest="100" 
                        HorizontalOptions="Center"
                        Margin="0,0,0,30"
                        StrokeShape="RoundRectangle 50"
                        Stroke="{DynamicResource AccentColor}"
                        StrokeThickness="2">
                    <Border.Shadow>
                        <Shadow Brush="{DynamicResource AccentColor}" 
                                Offset="0,0" 
                                Radius="30" 
                                Opacity="0.6"/>
                    </Border.Shadow>
                    <Image Source="logo.png" Margin="20"/>
                </Border>

                <Label Text="ورود یا ثبت‌نام"
                       FontSize="28"
                       FontAttributes="Bold"
                       HorizontalTextAlignment="Center"
                       TextColor="{DynamicResource PrimaryTextColor}"/>

                <Label Text="سالویکس مسنجر نسل جدید"
                       FontSize="16"
                       HorizontalTextAlignment="Center"
                       TextColor="{DynamicResource SecondaryTextColor}"
                       Margin="0,0,0,25"/>

                <!-- Phone Number Input with Neon Border -->
                <Border Style="{StaticResource NeonBorderStyle}"
                        Stroke="{DynamicResource FrameBorderColor}">
                    <Border.Triggers>
                        <DataTrigger TargetType="Border" 
                                     Binding="{Binding Errors[PhoneNumber].Count, FallbackValue=0, Converter={StaticResource GreaterThanZeroConverter}}" 
                                     Value="True">
                            <Setter Property="Stroke" Value="{DynamicResource ErrorColor}"/>
                            <Setter Property="Shadow">
                                <Shadow Brush="{DynamicResource ErrorColor}" 
                                        Offset="0,0" 
                                        Radius="10" 
                                        Opacity="0.5"/>
                            </Setter>
                        </DataTrigger>
                    </Border.Triggers>
                    <Entry x:Name="PhoneNumberEntry"
                           Placeholder="شماره تلفن (مثال: 0912...)"
                           Text="{Binding PhoneNumber, Mode=TwoWay}"
                           Keyboard="Telephone"
                           MaxLength="11"
                           IsEnabled="{Binding IsPhoneNumberLocked, Converter={StaticResource InverseBoolConverter}}"
                           BackgroundColor="Transparent"
                           TextColor="{DynamicResource PrimaryTextColor}"
                           PlaceholderColor="{DynamicResource TertiaryTextColor}"
                           FontSize="16"
                           HeightRequest="55"
                           Margin="15,0"/>
                </Border>

                <Label Style="{StaticResource ValidationLabelStyle}"
                       Text="{Binding Errors[PhoneNumber][0]}"
                       TextColor="{DynamicResource ErrorColor}"
                       FontSize="12"
                       Margin="10,0,0,5"/>

                <!-- Loading Animation -->
                <ActivityIndicator IsRunning="{Binding IsLoading}" 
                                   IsVisible="{Binding IsLoading}" 
                                   Color="{DynamicResource PrimaryColor}" 
                                   Margin="0,10"
                                   Scale="1.2"/>

                <!-- Password Input -->
                <Border Style="{StaticResource NeonBorderStyle}"
                        Stroke="{DynamicResource FrameBorderColor}"
                        IsVisible="{Binding ShowPasswordSection}">
                    <Border.Triggers>
                        <DataTrigger TargetType="Border" 
                                     Binding="{Binding Errors[Password].Count, FallbackValue=0, Converter={StaticResource GreaterThanZeroConverter}}" 
                                     Value="True">
                            <Setter Property="Stroke" Value="{DynamicResource ErrorColor}"/>
                        </DataTrigger>
                    </Border.Triggers>
                    <Grid ColumnDefinitions="*, Auto">
                        <Entry Placeholder="رمز عبور"
                               Text="{Binding Password, Mode=TwoWay}"
                               IsPassword="{Binding IsPasswordVisible, Converter={StaticResource InverseBoolConverter}}"
                               Grid.Column="0"
                               BackgroundColor="Transparent"
                               TextColor="{DynamicResource PrimaryTextColor}"
                               PlaceholderColor="{DynamicResource TertiaryTextColor}"
                               FontSize="16"
                               HeightRequest="55"
                               Margin="15,0"/>
                        <Button Grid.Column="1"
                                Command="{Binding TogglePasswordVisibilityCommand}"
                                BackgroundColor="Transparent"
                                TextColor="{DynamicResource SecondaryTextColor}"
                                FontFamily="MaterialIcons"
                                FontSize="24"
                                WidthRequest="40"
                                Margin="0,0,10,0">
                            <Button.Triggers>
                                <DataTrigger TargetType="Button" Binding="{Binding IsPasswordVisible}" Value="True">
                                    <Setter Property="Text" Value="visibility_off" />
                                </DataTrigger>
                                <DataTrigger TargetType="Button" Binding="{Binding IsPasswordVisible}" Value="False">
                                    <Setter Property="Text" Value="visibility" />
                                </DataTrigger>
                            </Button.Triggers>
                        </Button>
                    </Grid>
                </Border>

                <!-- Registration Fields -->
                <VerticalStackLayout IsVisible="{Binding ShowRegistrationSection}" Spacing="15" Margin="0,15,0,0">
                    <Label Text="تکمیل اطلاعات کاربری"
                           FontSize="18"
                           FontAttributes="Bold"
                           HorizontalTextAlignment="Center"
                           TextColor="{DynamicResource PrimaryTextColor}" 
                           Margin="0,0,0,10"/>

                    <Border Style="{StaticResource NeonBorderStyle}" Stroke="{DynamicResource FrameBorderColor}">
                        <Entry Placeholder="نام"
                               Text="{Binding FirstName, Mode=TwoWay}"
                               BackgroundColor="Transparent"
                               TextColor="{DynamicResource PrimaryTextColor}"
                               PlaceholderColor="{DynamicResource TertiaryTextColor}"
                               FontSize="16"
                               HeightRequest="55"
                               Margin="15,0"/>
                    </Border>

                    <Border Style="{StaticResource NeonBorderStyle}" Stroke="{DynamicResource FrameBorderColor}">
                        <Entry Placeholder="نام خانوادگی"
                               Text="{Binding LastName, Mode=TwoWay}"
                               BackgroundColor="Transparent"
                               TextColor="{DynamicResource PrimaryTextColor}"
                               PlaceholderColor="{DynamicResource TertiaryTextColor}"
                               FontSize="16"
                               HeightRequest="55"
                               Margin="15,0"/>
                    </Border>
                </VerticalStackLayout>

                <!-- Submit Button -->
                <controls:NeonButton Text="{Binding SubmitButtonText}"
                                     Command="{Binding SubmitCommand}"
                                     BackgroundColor="{DynamicResource PrimaryColor}"
                                     TextColor="{DynamicResource InverseTextColor}"
                                     GlowColor="{DynamicResource PrimaryColor}"
                                     BorderColor="{DynamicResource PrimaryColor}"
                                     FontSize="18"
                                     Margin="0,25,0,0"
                                     HeightRequest="55"/>
            </VerticalStackLayout>
        </ScrollView>
    </Grid>
</ContentPage>