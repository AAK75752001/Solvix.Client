<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:Solvix.Client.MVVM.ViewModels"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             x:Class="Solvix.Client.MVVM.Views.SettingsPage"
             x:DataType="viewmodels:SettingsViewModel"
             Title="Settings"
             Shell.NavBarIsVisible="False"
             BackgroundColor="{DynamicResource PageBackgroundColor}">

    <ContentPage.Resources>
        <ResourceDictionary>
            <toolkit:InvertedBoolConverter x:Key="InvertedBoolConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid RowDefinitions="Auto,*">
        <!-- Header -->
        <Border Grid.Row="0" 
                BackgroundColor="{DynamicResource PrimaryColor}" 
                Padding="15"
                StrokeThickness="0">
            <Border.Shadow>
                <Shadow Brush="{DynamicResource ShadowColor}"
                        Offset="0,4"
                        Opacity="0.2"
                        Radius="5" />
            </Border.Shadow>

            <Grid ColumnDefinitions="Auto,*">
                <!-- Back Button -->
                <Button Grid.Column="0"
                        Text="←"
                        Command="{Binding BackCommand}"
                        FontSize="24"
                        TextColor="White"
                        BackgroundColor="Transparent"
                        WidthRequest="40">
                </Button>

                <!-- Page Title -->
                <Label Grid.Column="1"
                       Text="Settings"
                       TextColor="White"
                       FontSize="20"
                       FontAttributes="Bold"
                       VerticalOptions="Center">
                    <Label.Shadow>
                        <Shadow Brush="{DynamicResource TertiaryColor}"
                                Offset="0,0"
                                Opacity="0.3"
                                Radius="5" />
                    </Label.Shadow>
                </Label>
            </Grid>
        </Border>

        <!-- Content -->
        <ScrollView Grid.Row="1">
            <Grid IsVisible="{Binding IsLoading, Converter={StaticResource InvertedBoolConverter}}">
                <VerticalStackLayout Spacing="20" Padding="20">
                    <!-- User Profile -->
                    <Border BackgroundColor="{DynamicResource CardBackgroundColor}" 
                            StrokeThickness="0"
                            StrokeShape="RoundRectangle 15,15,15,15"
                            Padding="20">
                        <Border.Shadow>
                            <Shadow Brush="{DynamicResource ShadowColor}"
                                    Offset="0,4"
                                    Opacity="0.1"
                                    Radius="8" />
                        </Border.Shadow>

                        <VerticalStackLayout Spacing="15">
                            <Grid ColumnDefinitions="Auto,*,Auto">
                                <!-- Profile Picture -->
                                <Border Grid.Column="0"
                                        BackgroundColor="{DynamicResource PrimaryColor}"
                                        StrokeThickness="0"
                                        StrokeShape="RoundRectangle 35,35,35,35"
                                        HeightRequest="70"
                                        WidthRequest="70"
                                        Padding="0"
                                        VerticalOptions="Center"
                                        HorizontalOptions="Center">
                                    <Border.Stroke>
                                        <LinearGradientBrush EndPoint="1,0">
                                            <GradientStop Color="{DynamicResource PrimaryColor}"
                                                          Offset="0.0" />
                                            <GradientStop Color="{DynamicResource SecondaryColor}"
                                                          Offset="1.0" />
                                        </LinearGradientBrush>
                                    </Border.Stroke>
                                    <Label Text="{Binding CurrentUser.Initials}"
                                           TextColor="White"
                                           FontSize="30"
                                           FontAttributes="Bold"
                                           VerticalOptions="Center"
                                           HorizontalOptions="Center" />
                                </Border>

                                <!-- User Info -->
                                <VerticalStackLayout Grid.Column="1" 
                                                     Spacing="5" 
                                                     Margin="15,0">
                                    <Label Text="{Binding CurrentUser.DisplayName}" 
                                           TextColor="{DynamicResource PrimaryTextColor}" 
                                           FontSize="18" 
                                           FontAttributes="Bold" />

                                    <Label Text="{Binding CurrentUser.PhoneNumber}" 
                                           TextColor="{DynamicResource SecondaryTextColor}" 
                                           FontSize="14" />
                                </VerticalStackLayout>

                                <!-- Edit Button -->
                                <Button Grid.Column="2"
                                        Text="Edit"
                                        Command="{Binding EditProfileCommand}"
                                        BackgroundColor="{DynamicResource PrimaryColor}"
                                        TextColor="White"
                                        FontAttributes="Bold"
                                        CornerRadius="20"
                                        HeightRequest="40"
                                        WidthRequest="80"
                                        FontSize="14"
                                        VerticalOptions="Center">
                                </Button>
                            </Grid>
                        </VerticalStackLayout>
                    </Border>

                    <!-- Appearance -->
                    <Label Text="Appearance" 
                           TextColor="{DynamicResource PrimaryTextColor}" 
                           FontSize="18" 
                           FontAttributes="Bold" 
                           Margin="5,10,0,0" />

                    <Border BackgroundColor="{DynamicResource CardBackgroundColor}" 
                            StrokeThickness="0"
                            StrokeShape="RoundRectangle 15,15,15,15"
                            Padding="20">
                        <Border.Shadow>
                            <Shadow Brush="{DynamicResource ShadowColor}"
                                    Offset="0,4"
                                    Opacity="0.1"
                                    Radius="8" />
                        </Border.Shadow>

                        <VerticalStackLayout Spacing="15">
                            <Label Text="Theme" 
                                   TextColor="{DynamicResource PrimaryTextColor}" 
                                   FontSize="16"
                                   FontAttributes="Bold" />

                            <Grid ColumnDefinitions="*,*">
                                <!-- Light Theme Option -->
                                <Border Grid.Column="0" 
                                        StrokeThickness="2"
                                        StrokeShape="RoundRectangle 10,10,10,10"
                                        Padding="10"
                                        Margin="0,0,5,0"
                                        Stroke="{Binding SelectedTheme, Converter={StaticResource StringToBoolConverter}, ConverterParameter='Light', TargetNullValue={DynamicResource PageBackgroundColor}, FallbackValue={DynamicResource PageBackgroundColor}}">
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding SelectThemeCommand}" CommandParameter="Light" />
                                    </Border.GestureRecognizers>

                                    <VerticalStackLayout HorizontalOptions="Center" Spacing="10">
                                        <Ellipse HeightRequest="25" 
                                                 WidthRequest="25" 
                                                 Fill="White"
                                                 Stroke="#DDDDDD"
                                                 StrokeThickness="1" />

                                        <Label Text="Light" 
                                               TextColor="{DynamicResource PrimaryTextColor}" 
                                               HorizontalOptions="Center" />

                                        <Ellipse HeightRequest="16" 
                                                 WidthRequest="16" 
                                                 Fill="{DynamicResource PrimaryColor}"
                                                 IsVisible="{Binding SelectedTheme, Converter={StaticResource StringToBoolConverter}, ConverterParameter='Light'}"
                                                 HorizontalOptions="Center" />
                                    </VerticalStackLayout>
                                </Border>

                                <!-- Dark Theme Option -->
                                <Border Grid.Column="1" 
                                        StrokeThickness="2"
                                        StrokeShape="RoundRectangle 10,10,10,10"
                                        Padding="10"
                                        Margin="5,0,0,0"
                                        Stroke="{Binding SelectedTheme, Converter={StaticResource StringToBoolConverter}, ConverterParameter='Dark', TargetNullValue={DynamicResource PageBackgroundColor}, FallbackValue={DynamicResource PageBackgroundColor}}">
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding SelectThemeCommand}" CommandParameter="Dark" />
                                    </Border.GestureRecognizers>

                                    <VerticalStackLayout HorizontalOptions="Center" Spacing="10">
                                        <Ellipse HeightRequest="25" 
                                                 WidthRequest="25" 
                                                 Fill="#1E1E1E"
                                                 Stroke="#333333"
                                                 StrokeThickness="1" />

                                        <Label Text="Dark" 
                                               TextColor="{DynamicResource PrimaryTextColor}" 
                                               HorizontalOptions="Center" />

                                        <Ellipse HeightRequest="16" 
                                                 WidthRequest="16" 
                                                 Fill="{DynamicResource PrimaryColor}"
                                                 IsVisible="{Binding SelectedTheme, Converter={StaticResource StringToBoolConverter}, ConverterParameter='Dark'}"
                                                 HorizontalOptions="Center" />
                                    </VerticalStackLayout>
                                </Border>
                            </Grid>
                        </VerticalStackLayout>
                    </Border>

                    <!-- Account -->
                    <Label Text="Account" 
                           TextColor="{DynamicResource PrimaryTextColor}" 
                           FontSize="18" 
                           FontAttributes="Bold" 
                           Margin="5,10,0,0" />

                    <Border BackgroundColor="{DynamicResource CardBackgroundColor}" 
                            StrokeThickness="0"
                            StrokeShape="RoundRectangle 15,15,15,15"
                            Padding="0">
                        <Border.Shadow>
                            <Shadow Brush="{DynamicResource ShadowColor}"
                                    Offset="0,4"
                                    Opacity="0.1"
                                    Radius="8" />
                        </Border.Shadow>

                        <VerticalStackLayout>
                            <Border StrokeThickness="0"
                                    Padding="20,15">
                                <Border.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding AboutCommand}" />
                                </Border.GestureRecognizers>

                                <Grid ColumnDefinitions="*,Auto">
                                    <Label Grid.Column="0"
                                           Text="About Solvix Chat"
                                           TextColor="{DynamicResource PrimaryTextColor}"
                                           FontSize="16"
                                           VerticalOptions="Center" />

                                    <Label Grid.Column="1"
                                           Text="›"
                                           TextColor="{DynamicResource TertiaryTextColor}"
                                           FontSize="20"
                                           VerticalOptions="Center" />
                                </Grid>
                            </Border>

                            <BoxView HeightRequest="1" 
                                     Color="{DynamicResource SeparatorColor}" 
                                     Margin="15,0"
                                     HorizontalOptions="FillAndExpand" />

                            <Border StrokeThickness="0"
                                    Padding="20,15">
                                <Border.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding LogoutCommand}" />
                                </Border.GestureRecognizers>

                                <Grid ColumnDefinitions="*,Auto">
                                    <Label Grid.Column="0"
                                           Text="Logout"
                                           TextColor="{DynamicResource ErrorColor}"
                                           FontSize="16"
                                           FontAttributes="Bold"
                                           VerticalOptions="Center" />

                                    <Label Grid.Column="1"
                                           Text="›"
                                           TextColor="{DynamicResource TertiaryTextColor}"
                                           FontSize="20"
                                           VerticalOptions="Center" />
                                </Grid>
                            </Border>
                        </VerticalStackLayout>
                    </Border>

                    <!-- Version -->
                    <Label Text="Version 1.0.0" 
                           TextColor="{DynamicResource TertiaryTextColor}" 
                           FontSize="14" 
                           HorizontalOptions="Center" 
                           Margin="0,20,0,0" />
                </VerticalStackLayout>
            </Grid>
        </ScrollView>

        <!-- Loading Indicator -->
        <Border Grid.RowSpan="2"
                IsVisible="{Binding IsLoading}"
                HorizontalOptions="Center"
                VerticalOptions="Center"
                StrokeThickness="0"
                StrokeShape="RoundRectangle 12,12,12,12"
                BackgroundColor="{DynamicResource CardBackgroundColor}"
                Padding="20">
            <Border.Shadow>
                <Shadow Brush="{DynamicResource ShadowColor}"
                        Offset="0,3"
                        Opacity="0.2"
                        Radius="10" />
            </Border.Shadow>
            <VerticalStackLayout Spacing="15">
                <ActivityIndicator IsRunning="{Binding IsLoading}" 
                                    Color="{DynamicResource PrimaryColor}" 
                                    HeightRequest="50" 
                                    WidthRequest="50" />
                <Label Text="Loading settings..." 
                        TextColor="{DynamicResource PrimaryTextColor}" 
                        FontSize="16" 
                        HorizontalOptions="Center" />
            </VerticalStackLayout>
        </Border>
    </Grid>
</ContentPage>